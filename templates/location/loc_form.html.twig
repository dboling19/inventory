{% block form %}
<div class="db-panel db-wrapper db-third">
  <form id="loc_form" class="db-wrapper db-fill db-column db-border" method="post">
    <div class="db-form-section">
      <label for="loc_code">
        Loc Code
        <input type="text" class="db-input db-border db-filter" id="loc_code" name="loc_code" list="loc_code_datalist"></input>
        <datalist id="loc_code_datalist">
          {% for loc in result %}
            <option value="{{ loc.locCode }}">{{ loc.locCode }}</option>
          {% endfor %}
        </datalist>
      </label>
    </div>
    <div class="db-form-section">
      <label for="loc_desc">
        Loc Desc
        <input class="db-input db-border" id="loc_desc" name="loc_desc"></input>
      </label>
    </div>
    <div class="db-form-section">
      <label for="loc_notes">Notes</label>
      <textarea class="db-input db-border" id="loc_notes" name="loc_notes"></textarea>
    </div>
  </form>
</div>

<script>
const params = {{ params|json_encode()|raw }};
const input_fields = ['loc_code', 'loc_desc', 'loc_notes'];
// must add all desired fields to above list, and ensure array keys coming from PHP match related IDs.
input_fields.forEach(id => load_data(id));
function load_data(id)
{
  input = document.getElementById(id);
  input.value = params[id];
}

loc_form.addEventListener('input', (event) => add_unload_handler());

function add_unload_handler(event)
{
  if (event.target.value !== "") {
    window.addEventListener("beforeunload", beforeUnloadHandler);
  } else {
    window.removeEventListener("beforeunload", beforeUnloadHandler);
  }
}

function clear_form()
{
  loc_form.reset();
}
</script>
{% endblock %}